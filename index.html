<!DOCTYPE html>
<html lang="id">
<head>
  <link rel="stylesheet" href="style.css" />
  <meta charset="UTF-8" />
  <title>Batu Gunting Kertas Online</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>ğŸª¨âœ‚ï¸ğŸ“„ Batu Gunting Kertas</h1>

  <input type="text" id="playerName" placeholder="ğŸ§‘â€ğŸ¤ Nama kamu" />
  <input type="text" id="roomCode" placeholder="ğŸ”‘ Kode room" />
  <button onclick="joinRoom()">Gabung Room</button>

  <div id="gameArea" style="display: none;">
    <h2 id="vsText">Bertanding dengan ...</h2>

    <div id="scores">
      <p>ğŸ‘¤ <span id="myName">Kamu</span>: <span id="myScore">0</span></p>
      <p>ğŸ§‘ <span id="opponentName">Lawan</span>: <span id="opponentScore">0</span></p>
    </div>

    <h3>Pilih:</h3>
    <button onclick="makeMove('batu')">ğŸª¨ Batu</button>
    <button onclick="makeMove('gunting')">âœ‚ï¸ Gunting</button>
    <button onclick="makeMove('kertas')">ğŸ“„ Kertas</button>

    <h3 id="status">Menunggu lawan bergabung...</h3>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCXU7oqo3m3ry7om9qQ5zfOGTu-mL_YOrc",
      authDomain: "realtime-database-99f23.firebaseapp.com",
      databaseURL: "https://realtime-database-99f23-default-rtdb.firebaseio.com",
      projectId: "realtime-database-99f23",
      storageBucket: "realtime-database-99f23.appspot.com",
      messagingSenderId: "642043922874",
      appId: "1:642043922874:web:4df5d383e2867bcd2cf583"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let playerId = "player_" + Math.floor(Math.random() * 10000);
    let room = "";
    let playerName = "";
    let opponentId = "";
    let opponentName = "";

    function joinRoom() {
      room = document.getElementById("roomCode").value.trim();
      playerName = document.getElementById("playerName").value.trim();

      if (!room || !playerName) return alert("Isi nama dan kode room!");
      
      db.ref(`rooms/${room}/${playerId}`).set({
        name: playerName,
        move: null,
        score: 0,
      });

      document.getElementById("gameArea").style.display = "block";
      document.getElementById("myName").innerText = playerName;

      listenForPlayers();
    }

    function listenForPlayers() {
      db.ref(`rooms/${room}`).on("value", (snapshot) => {
        const data = snapshot.val();
        if (!data) return;

        const players = Object.keys(data);
        if (players.length < 2) {
          document.getElementById("status").innerText = "Menunggu lawan bergabung...";
          return;
        }

        opponentId = players.find(p => p !== playerId);
        opponentName = data[opponentId]?.name || "Lawan";

        document.getElementById("opponentName").innerText = opponentName;
        document.getElementById("vsText").innerText = `Kamu vs ${opponentName}`;

        const myData = data[playerId];
        const oppData = data[opponentId];

        document.getElementById("myScore").innerText = myData?.score || 0;
        document.getElementById("opponentScore").innerText = oppData?.score || 0;

        const myMove = myData?.move;
        const oppMove = oppData?.move;

        if (myMove && oppMove) {
          const result = checkWinner(myMove, oppMove);
          let winner = "draw";

          if (result !== "draw") {
            winner = result === myMove ? playerId : opponentId;
          }

          if (winner === "draw") {
            document.getElementById("status").innerText = `Draw! (${myMove} vs ${oppMove})`;
          } else if (winner === playerId) {
            document.getElementById("status").innerText = "ğŸ‰ Kamu menang!";
            db.ref(`rooms/${room}/${playerId}/score`).set((myData.score || 0) + 1);
          } else {
            document.getElementById("status").innerText = "ğŸ˜¢ Kamu kalah!";
            db.ref(`rooms/${room}/${opponentId}/score`).set((oppData.score || 0) + 1);
          }

          // Reset move setelah 3 detik
          setTimeout(() => {
            db.ref(`rooms/${room}/${playerId}/move`).set(null);
            db.ref(`rooms/${room}/${opponentId}/move`).set(null);
            document.getElementById("status").innerText = "Pilih lagi!";
          }, 3000);
        }
      });
    }

    function makeMove(choice) {
      db.ref(`rooms/${room}/${playerId}/move`).set(choice);
      document.getElementById("status").innerText = "Menunggu lawan memilih...";
    }

    function checkWinner(a, b) {
      if (a === b) return "draw";
      if (
        (a === "batu" && b === "gunting") ||
        (a === "gunting" && b === "kertas") ||
        (a === "kertas" && b === "batu")
      ) {
        return a;
      } else {
        return b;
      }
    }
  </script>
</body>
</html>
